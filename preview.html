<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Preview CV</title>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <style>
    body {
      font-family: 'Calibri', 'Arial', sans-serif;
      background-color: #f8f9fa;
      font-size: 20px;
    }

    h1, h5 {
      color: #343a40;
    }

    hr {
      border-top: 1px solid #6c757d;
    }

    .left-column {
      background-color: #e3f2fd;
      min-height: 100vh;
      padding-top: 30px;
    }

    .right-column {
      background-color: #fdf6f6;
      padding: 30px;
      color: black;
    }

    .rounded-circle {
      width: 150px;
      height: 150px;
      object-fit: cover;
    }

    .social-media img {
      width: 24px;
      height: 24px;
    }

    .container-header {
      background-color: #e3f2fd;
      color: black;
      padding: 20px;
      text-align: center;
      margin-top: 20px;
    }

    .preview-buttons {
      margin-top: 20px;
    }
    
    .judul {
      background-color: black;
      color: white;
      padding: 7px 0px 7px 20px;
    }
    .isi{
        margin-top: 15px;
        border: 1px solid rgb(240, 212, 212);
        background-color:black;
        margin-bottom: 10px;
    }
    .bawah{
        margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div id="previewPage">
    <div class="container isi">
      <div class="container-header">
        <h1 class="judul">Curriculum Vitae</h1>
      </div>
      
      <div class="row no-gutters bawah">
        <div class="col-md-4 left-column">
          <div class="p-4">
            <div class="d-flex flex-column align-items-center">
              <img id="profilePicPreview" src="" class="img-fluid mb-3" alt="Profile Picture" width="200px" height="350px">
            </div>
            <h1 class="mt-3 text-center" id="namePreview"></h1>
            <p>
                <ul>
                    <li><strong>Alamat:</strong> <span id="addressPreview"></span></li>
                    <li><strong>Email:</strong> <span id="emailPreview"></span></li>
                    <li><strong>Telepon:</strong> <span id="phonePreview"></span></li>
                  </ul>
            </p>    
            <h5 class="text-center judul">Sosial Media</h5>
            <div class="social-media">
              <div class="row mb-2">
                <div class="col-2"><img src="facebook.png" alt="Facebook" class="img-fluid"></div>
                <div class="col-8" id="facebookPreview"></div>
              </div>
              <div class="row mb-2">
                <div class="col-2"><img src="twitter.png" alt="Twitter" class="img-fluid"></div>
                <div class="col-8" id="twitterPreview"></div>
              </div>
              <div class="row mb-2">
                <div class="col-2"><img src="instagram.png" alt="Instagram" class="img-fluid"></div>
                <div class="col-8" id="instagramPreview"></div>
              </div>
              <div class="row mb-2">
                <div class="col-2"><img src="github.png" alt="GitHub" class="img-fluid"></div>
                <div class="col-8" id="githubPreview"></div>
              </div>
            </div>
            <h5 class="text-center judul">Personal Skill</h5>
            <ul id="personalSkillPreviewList"></ul>
          </div>
        </div>
        <div class="col-md-8 right-column">
          <div class="p-4">
            <h5 class="judul">Pendidikan</h5>
            <ul ><li id="educationPreviewList"></li></ul>
            <hr>
            <h5 class="judul">Pengalaman Kerja</h5>
            <ul id="experiencePreviewList"></ul>
            <hr>
            <h5 class="judul">Pengalaman Organisasi</h5>
            <ul id="organizationPreviewList"></ul>
            <hr>
            <h5 class="judul">Hobi</h5>
            <ul id="hobiPreviewList"></ul>
            <hr>
            <div class="container text-center preview-buttons" id="previewButtons">
              <!-- <button onclick="scrollToTopAndExecute(saveAsPDF)" class="btn btn-success mt-3">Simpan sebagai PDF</button>
              <button onclick="scrollToTopAndExecute(printCV)" class="btn btn-success mt-3">Cetak</button> -->
              <button onclick="scrollToTopAndExecute(saveAsImage)" class="btn btn-success mt-3">Simpan sebagai Gambar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var profilePicSrc = localStorage.getItem('profilePicSrc');
      var name = localStorage.getItem('name');
      var address = localStorage.getItem('address');
      var email = localStorage.getItem('email');
      var phone = localStorage.getItem('phone');
      var facebook = localStorage.getItem('facebook');
      var twitter = localStorage.getItem('twitter');
      var instagram = localStorage.getItem('instagram');
      var github = localStorage.getItem('github');

      document.getElementById('profilePicPreview').src = profilePicSrc;
      document.getElementById('namePreview').innerText = name;
      document.getElementById('addressPreview').innerText = address;
      document.getElementById('emailPreview').innerText = email;
      document.getElementById('phonePreview').innerText = phone;
      document.getElementById('facebookPreview').innerText = facebook;
      document.getElementById('twitterPreview').innerText = twitter;
      document.getElementById('instagramPreview').innerText = instagram;
      document.getElementById('githubPreview').innerText = github;

      loadListFromLocalStorage('personalSkillPreviewList', 'personalSkillData');
      loadListFromLocalStorage('educationPreviewList', 'educationData');
      loadListFromLocalStorage('experiencePreviewList', 'experienceData');
      loadListFromLocalStorage('organizationPreviewList', 'organizationData');
      loadListFromLocalStorage('hobiPreviewList', 'hobiData');
    });

    function loadListFromLocalStorage(previewListId, localStorageKey) {
      var previewList = document.getElementById(previewListId);
      var data = JSON.parse(localStorage.getItem(localStorageKey));
      previewList.innerHTML = '';
      data.forEach(function(item) {
        var li = document.createElement("li");
        li.innerText = item;
        previewList.appendChild(li);
      });
    }

    function scrollToTopAndExecute(callback) {
      window.scrollTo({ top: 0, behavior: 'smooth' });
      setTimeout(callback, 500);  // Adjust the timeout as needed
    }

    function saveAsPDF() {
      document.getElementById('previewButtons').style.display = 'none';
      html2canvas(document.getElementById('previewPage')).then(canvas => {
        var imgData = canvas.toDataURL('image/png');
        var doc = new jsPDF({
          orientation: 'portrait',
          unit: 'mm',
          format: 'a4'
        });
        var imgProps = doc.getImageProperties(imgData);
        var pdfWidth = doc.internal.pageSize.getWidth();
        var pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
        doc.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
        doc.save('cv.pdf');
        document.getElementById('previewButtons').style.display = 'block';
      });
    }

    function printCV() {
      document.getElementById('previewButtons').style.display = 'none';
      window.print();
      document.getElementById('previewButtons').style.display = 'block';
    }

    function saveAsImage() {
      document.getElementById('previewButtons').style.display = 'none';
      html2canvas(document.getElementById('previewPage')).then(canvas => {
        var link = document.createElement('a');
        link.href = canvas.toDataURL();
        link.download = 'cv.png';
        link.click();
        document.getElementById('previewButtons').style.display = 'block';
      });
    }
  </script>
</body>
</html>
